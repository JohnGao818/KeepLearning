### 防抖与节流
#### 1. 防抖
> 触发高频事件后n秒内函数只会执行一次，如果n秒内高频事件再次被触发，则重新计算时间

举一个最容易理解的例子：对一个较高点击率的按钮应用防抖，例如刷新按钮，引入防抖之前，间隔一秒连续点击**十次**按钮触发十次刷新。引入防抖，并设置防抖间隔为2秒，则只有最后一次点击才会触发刷新。

##### 为什么引入防抖

前端的事件大多由后端接口来响应，为避免短时间内发起多次重复请求，降低服务端压力

##### 如何实现防抖

```javascript
/**
 * fn: 事件触发时，所要执行的回调函数，包含响应事件的业务逻辑
 * timer： 防抖间隔
 **/
function debounce(fn, timer = 500) {
    let timeOut = null;
    return () => {
        clearTimeout(timeOut);
        timeOut = setTimeout(() => {
            fn.apply(this, arguments);
        }, timer);
    }
}
```

**原理：** 注册一个定时器，在指定的时间内，如果事件重复触发，则重置该定时器，继续等待下一个事件，直到该定时器执行。

**注意：**
1. 之所以用apply方法来执行回调函数的原因是保证this指向正确的对象
2. 防抖间隔设置的过短，则降低防抖的效果。过长则增加了事件的响应速度。所以要综合考虑，设置一个合理的防抖间隔

#### 2. 节流
> 高频事件触发，但在n秒内只会执行一次，所以节流会稀释函数的执行频率

同样的例子我们来用节流看一下效果：
对一个较高点击率的按钮应用节流，例如刷新按钮，引入防抖之前，间隔一秒连续点击**十次**按钮触发十次刷新。引入节流，并设置节流间隔为2秒，则只有五次点击触发响应。若节流间隔为5秒，则只有两次点击触发响应。

##### 为什么引入节流

同样为避免短时间内触发多次事件，但这些事件并不一定是重复的，典型的例子是鼠标拖拽事件，鼠标在拖拽过程中会触发大量的事件，对这些事件应用节流，使得指定时间内的事件被合并为一次事件进行触发。

##### 如何实现节流
```javascript
/**
 * fn: 事件触发时，所要执行的回调函数，包含响应事件的业务逻辑
 * timer： 防抖间隔
 **/
function throttle(fn, timer = 500) {
    let runFlag = true; // 通过该变量来标记本次节流间隔内是否已经触发了一次响应
    return () => {
        if (!runFlag) {
            return;
        } else {
            runFlag = false;
            setTimeout(() => {
                fn.apply(this, arguments);
                runFlag = true;
            }, timer);
        }
    }
}
```

**原理：** 注册一个定时器，在等待定时器触发回调函数过程中，抛弃所有事件

**注意：**
1. 之所以用apply方法来执行回调函数的原因是保证this指向正确的对象
2. 节流间隔设置的过短，则降低节流的效果。过长则会过度稀释事件的响应频率。所以要综合考虑，设置一个合理的节流间隔
3. 根据本节流实现方法不难看出，在一段节流间隔内，第一次事件被响应，但直到本次时间间隔结束，该响应才被真正执行。该逻辑可以进行微调，例如：

```javascript
/**
 * fn: 事件触发时，所要执行的回调函数，包含响应事件的业务逻辑
 * timer： 防抖间隔
 **/
function throttle(fn, timer = 500) {
    let runFlag = true; // 通过该变量来标记本次节流间隔内是否已经触发了一次响应
    return () => {
        if (!runFlag) {
            return;
        } else {
            runFlag = false;
            fn.apply(this, arguments); // 事件被响应时函数立即执行
            setTimeout(() => {
                runFlag = true;
            }, timer);
        }
    }
}
```

也同样可以实现节流效果;

